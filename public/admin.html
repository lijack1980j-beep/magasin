<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin – Glitch Signal</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
  <style>
    /* Small extra styles (keeps your design, but makes admin clean) */
    .admin-wrap { padding: 90px 0 60px; }
    .admin-card {
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 18px;
      padding: 22px;
      backdrop-filter: blur(10px);
    }
    .admin-grid {
      display: grid;
      grid-template-columns: 1.2fr 0.8fr;
      gap: 18px;
      margin-top: 18px;
    }
    @media (max-width: 900px){
      .admin-grid { grid-template-columns: 1fr; }
    }

    .admin-title { margin: 0 0 8px; }
    .admin-sub { opacity: 0.85; margin: 0 0 18px; }

    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
    @media (max-width: 700px){
      .form-row { grid-template-columns: 1fr; }
    }

    .admin-card label { display:block; font-size: 0.9rem; opacity: 0.9; margin: 10px 0 6px; }
    .admin-card input, .admin-card textarea, .admin-card select {
      width: 100%;
      padding: 12px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.25);
      color: #fff;
      outline: none;
      font-family: Poppins, sans-serif;
    }
    .admin-card textarea { resize: vertical; min-height: 90px; }

    .btn-row { display:flex; gap: 10px; flex-wrap: wrap; margin-top: 14px; }
    .btn {
      padding: 10px 14px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      color: #fff;
      cursor: pointer;
      font-weight: 600;
    }
    .btn.primary { background: rgba(0, 255, 255, 0.12); border-color: rgba(0,255,255,0.25); }
    .btn.danger { background: rgba(255, 0, 80, 0.14); border-color: rgba(255,0,80,0.28); }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }

    .table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      overflow: hidden;
      border-radius: 14px;
    }
    .table th, .table td {
      padding: 10px 10px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      text-align: left;
      font-size: 0.95rem;
      vertical-align: top;
    }
    .table th { opacity: 0.9; font-weight: 700; }
    .muted { opacity: 0.75; font-size: 0.92rem; }
    .pill {
      display:inline-block;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.14);
      background: rgba(255,255,255,0.06);
      font-size: 0.82rem;
      opacity: 0.95;
    }
    .split { display:flex; align-items:center; justify-content: space-between; gap: 10px; }
    .hidden { display:none !important; }
    .notice { margin-top: 10px; padding: 10px 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.12); background: rgba(255,255,255,0.05); }
  </style>
</head>
<body>

  <header class="navbar">
    <div class="container nav-container">
      <div class="logo"><a href="index.html">Glitch&nbsp;Signal</a></div>
      <nav id="nav-menu" class="nav-links">
        <a href="index.html#about">About</a>
        <a href="index.html#services">Services</a>
        <a href="index.html#portfolio">Portfolio</a>
        <a href="index.html#contact">Contact</a>
        <a href="admin.html" class="active">Admin</a>
      </nav>
      <button id="nav-toggle" aria-label="Toggle navigation">
        <span class="bar"></span><span class="bar"></span><span class="bar"></span>
      </button>
    </div>
  </header>

  <main class="admin-wrap">
    <div class="container">

      <!-- LOGIN -->
      <section id="admin-login" class="admin-card">
        <h1 class="admin-title">Admin Panel</h1>
        <p class="admin-sub">Login to manage projects and view clients.</p>

        <label for="admin-password">Admin Password</label>
        <input type="password" id="admin-password" placeholder="Enter password" />

        <div class="btn-row">
          <button class="btn primary" id="login-btn">Login</button>
          <button class="btn" id="change-pass-btn" type="button">Change Password</button>
        </div>

        <div class="notice muted">
          Prototype mode: password is stored locally in your browser.
        </div>
      </section>
      <section class="container" style="padding-top:140px;">
        <h2>Gallery Manager</h2>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px;">
        <input id="pTitle" placeholder="Title" style="padding:12px;border-radius:8px;background:#131313;border:1px solid rgba(255,255,255,.12);color:#fff;" />
        <select id="pCategory" style="padding:12px;border-radius:8px;background:#131313;border:1px solid rgba(255,255,255,.12);color:#fff;">
            <option value="uiux">UI/UX</option>
            <option value="interior">Interior</option>
            <option value="exterior">Exterior</option>
            <option value="other">Other</option>
        </select>
        </div>

    <textarea id="pDescription" placeholder="Description" rows="4"
      style="width:100%;margin-top:12px;padding:12px;border-radius:8px;background:#131313;border:1px solid rgba(255,255,255,.12);color:#fff;"></textarea>

    <input id="pTags" placeholder="Tags (comma separated) e.g. modern, minimal, figma"
      style="width:100%;margin-top:12px;padding:12px;border-radius:8px;background:#131313;border:1px solid rgba(255,255,255,.12);color:#fff;" />

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px;">
      <input id="pLive" placeholder="Live URL (optional)" style="padding:12px;border-radius:8px;background:#131313;border:1px solid rgba(255,255,255,.12);color:#fff;" />
      <input id="pRepo" placeholder="GitHub URL (optional)" style="padding:12px;border-radius:8px;background:#131313;border:1px solid rgba(255,255,255,.12);color:#fff;" />
    </div>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px;align-items:center;">
      <label style="display:flex;gap:8px;align-items:center;color:#ccc;">
        <input id="pFeatured" type="checkbox" />
        Featured
      </label>
      <input id="pSort" type="number" placeholder="Sort order (0..)" value="0"
        style="padding:12px;border-radius:8px;background:#131313;border:1px solid rgba(255,255,255,.12);color:#fff;" />
    </div>

    <div style="margin-top:12px;">
      <label style="display:block;margin-bottom:6px;color:#ccc;">Cover image (upload) OR paste image URL</label>
      <input id="pFile" type="file" accept="image/*" style="width:100%;color:#ccc;" />
      <input id="pImageUrl" placeholder="OR image URL (optional)"
        style="width:100%;margin-top:10px;padding:12px;border-radius:8px;background:#131313;border:1px solid rgba(255,255,255,.12);color:#fff;" />
    </div>

    <button id="saveProjectBtn" class="submit-button" style="margin-top:14px;">Save to Gallery</button>
    <p id="adminStatus" style="margin-top:10px;color:#ccc;"></p>

    <hr style="border-color:rgba(255,255,255,.08);margin:24px 0;" />

    <h3 style="margin-bottom:10px;">Existing Gallery Projects</h3>
    <div id="projectsList" style="display:grid;gap:12px;"></div>
  </div>
</section>

<script src="/admin-gallery.js"></script>

      

      <!-- DASHBOARD -->
      <section id="admin-dashboard" class="hidden">
        <div class="split" style="padding-top=:140px;">
          <div>
            <h2 style="margin:0;">Dashboard</h2>
            <div class="muted">Manage store projects + see purchases.</div>
          </div>
        <div class="btn-row" style="margin:0;">
            <button class="btn" id="seed-demo-btn" type="button">Seed Demo Data</button>
            <button class="btn danger" id="logout-btn" type="button">Logout</button>
          </div>
        </div>

        <div class="admin-grid">
          <!-- PROJECT FORM -->
          <div class="admin-card">
            <h3 style="margin-top:0;">Add / Edit Project</h3>
            <p class="muted" style="margin-top:0;">
              These projects can be used by your store pages later (UI/UX, Interior, Exterior).
            </p>

            <input type="hidden" id="project-id" />

            <div class="form-row">
              <div>
                <label for="project-title">Title</label>
                <input id="project-title" type="text" placeholder="e.g. Modern Facade Concept" />
              </div>
              <div>
                <label for="project-category">Category</label>
                <select id="project-category">
                  <option value="uiux">UI/UX</option>
                  <option value="interior">Interior Architecture</option>
                  <option value="exterior">Exterior Architecture</option>
                </select>
              </div>
            </div>

            <label for="project-desc">Description</label>
            <textarea id="project-desc" placeholder="Short description..."></textarea>

            <div class="form-row">
              <div>
                <label for="project-price">Price (USD)</label>
                <input id="project-price" type="number" step="0.01" placeholder="29.00" />
              </div>
              <div>
                <label for="project-image">Image (URL / Path)</label>
                <input id="project-image" type="text" placeholder="images/uiux.png OR https://..." />

                <label for="project-image-file">Upload Image (recommended)</label>
                <input id="project-image-file" type="file" accept="image/*" />

                <label for="project-video-url">Video (URL)</label>
                <input id="project-video-url" type="text" placeholder="https://youtube.com/... or direct .mp4 link" />

                <label for="project-video-file">Upload Video (small only)</label>
                <input id="project-video-file" type="file" accept="video/*" />

                    
              </div>
            </div>

            <div class="btn-row">
              <button class="btn primary" id="save-project-btn" type="button">Save Project</button>
              <button class="btn" id="reset-form-btn" type="button">Reset</button>
              <button class="btn danger" id="delete-project-btn" type="button" disabled>Delete</button>
            </div>

            <div id="form-msg" class="notice muted hidden"></div>
          </div>

          <!-- CLIENTS -->
          <div class="admin-card">
            <h3 style="margin-top:0;">Clients / Purchases</h3>
            <p class="muted" style="margin-top:0;">
              This reads from localStorage. You can connect it to your cart later.
            </p>

            <div class="btn-row" style="margin-top:0;">
              <button class="btn" id="export-clients-btn" type="button">Export JSON</button>
              <button class="btn danger" id="clear-clients-btn" type="button">Clear Clients</button>
            </div>

            <div id="clients-empty" class="notice muted">No purchases yet.</div>
            <div style="overflow:auto;">
              <table class="table" id="clients-table" style="display:none;">
                <thead>
                  <tr>
                    <th>Client</th>
                    <th>Email</th>
                    <th>Project</th>
                    <th>Paid</th>
                    <th>Date</th>
                  </tr>
                </thead>
                <tbody id="clients-body"></tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- PROJECT LIST -->
        <section class="admin-card" style="margin-top:18px;">
          <div class="split">
            <div>
              <h3 style="margin:0;">All Projects</h3>
              <div class="muted">Click a project to edit it.</div>
            </div>
            <div class="btn-row" style="margin:0;">
              <button class="btn" id="export-projects-btn" type="button">Export JSON</button>
              <button class="btn danger" id="clear-projects-btn" type="button">Clear Projects</button>
            </div>
          </div>

          <div style="overflow:auto;">
            <table class="table" id="projects-table">
              <thead>
                <tr>
                  <th>Title</th>
                  <th>Category</th>
                  <th>Description</th>
                  <th>Price</th>
                  <th>Image</th>
                </tr>
              </thead>
              <tbody id="projects-body"></tbody>
            </table>
          </div>

          
        </section>
      </section>

    </div>
  </main>

  <script src="script.js"></script>

  <!-- Admin Logic -->
  <script>
    // ====== Storage Keys ======
    const KEY_ADMIN_PASS = "gs_admin_password";
    const KEY_ADMIN_AUTH = "gs_admin_authed";
    const KEY_PROJECTS   = "gs_projects";
    const KEY_CLIENTS    = "gs_clients";

    // ====== Default password (first time only) ======
    const DEFAULT_PASS = "0000";

    // ====== Helpers ======
    const $ = (id) => document.getElementById(id);


    function fileToDataUrl(file) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result);
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

    function isProbablyTooBigForLocalStorage(dataUrl) {
        // localStorage limit is usually ~5MB total; keep a safe margin
        // Base64 expands size ~33%
        const approxBytes = Math.ceil((dataUrl.length - "data:".length) * 0.75);
        return approxBytes > 2_000_000; // ~2MB safe threshold
}

    function safeParse(json, fallback){
      try { return JSON.parse(json); } catch(e) { return fallback; }
    }

    function getProjects(){
      return safeParse(localStorage.getItem(KEY_PROJECTS), []);
    }
    function setProjects(projects){
      localStorage.setItem(KEY_PROJECTS, JSON.stringify(projects));
    }

    function getClients(){
      return safeParse(localStorage.getItem(KEY_CLIENTS), []);
    }
    function setClients(clients){
      localStorage.setItem(KEY_CLIENTS, JSON.stringify(clients));
    }

    function categoryLabel(val){
      if(val === "uiux") return "UI/UX";
      if(val === "interior") return "Interior";
      if(val === "exterior") return "Exterior";
      return val;
    }

    function showMsg(text){
      const box = $("form-msg");
      box.textContent = text;
      box.classList.remove("hidden");
      setTimeout(() => box.classList.add("hidden"), 2200);
    }

    function newId(){
      return "p_" + Math.random().toString(16).slice(2) + Date.now().toString(16);
    }

    // ====== Auth ======
    function ensurePassword(){
      if(!localStorage.getItem(KEY_ADMIN_PASS)){
        localStorage.setItem(KEY_ADMIN_PASS, DEFAULT_PASS);
      }
    }

    function isAuthed(){
      return localStorage.getItem(KEY_ADMIN_AUTH) === "true";
    }

    function setAuthed(val){
      localStorage.setItem(KEY_ADMIN_AUTH, val ? "true" : "false");
    }

    function showLogin(){
      $("admin-login").classList.remove("hidden");
      $("admin-dashboard").classList.add("hidden");
      $("admin-password").value = "0000";
    }

    function showDashboard(){
      $("admin-login").classList.add("hidden");
      $("admin-dashboard").classList.remove("hidden");
      renderProjects();
      renderClients();
      resetForm();
    }

    // ====== Render Projects ======
    function renderProjects(){
      const tbody = $("projects-body");
      tbody.innerHTML = "";
      const projects = getProjects();

      if(projects.length === 0){
        const tr = document.createElement("tr");
        tr.innerHTML = `<td colspan="5" class="muted">No projects yet. Add one above.</td>`;
        tbody.appendChild(tr);
        return;
      }

      projects.forEach(p => {
        const tr = document.createElement("tr");
        tr.style.cursor = "pointer";
        tr.innerHTML = `
          <td><strong>${escapeHtml(p.title)}</strong></td>
          <td><span class="pill">${categoryLabel(p.category)}</span></td>
          <td class="muted">${escapeHtml(p.desc || "")}</td>
          <td>$${Number(p.price || 0).toFixed(2)}</td>
          <td class="muted">${escapeHtml(p.image || "")}</td>
        `;
        tr.addEventListener("click", () => loadProjectToForm(p.id));
        tbody.appendChild(tr);
      });
    }

    function loadProjectToForm(id){
      const projects = getProjects();
      const p = projects.find(x => x.id === id);
      if(!p) return;

      $("project-video-url").value = p.videoUrl || "";
      $("project-id").value = p.id;
      $("project-title").value = p.title || "";
      $("project-category").value = p.category || "uiux";
      $("project-desc").value = p.desc || "";
      $("project-price").value = p.price ?? "";
      $("project-image").value = p.image || "";

      $("delete-project-btn").disabled = false;
      showMsg("Loaded for editing.");
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function resetForm(){
       $("project-id").value = "";
       $("project-title").value = "";
       $("project-category").value = "uiux";
       $("project-desc").value = "";
       $("project-price").value = "";
       $("project-image").value = "";
       $("project-video-url").value = "";
       if ($("project-image-file")) $("project-image-file").value = "";
       if ($("project-video-file")) $("project-video-file").value = "";
       $("delete-project-btn").disabled = true;
}
    function validateProject(){
      const title = $("project-title").value.trim();
      const price = $("project-price").value.trim();

      if(!title) return "Title is required.";
      if(price && Number(price) < 0) return "Price must be positive.";
      return null;
    }

    async function saveProject(){
  const err = validateProject();
  if(err) return showMsg(err);

  const projects = getProjects();
  const id = $("project-id").value || newId();

  // Start with the manual inputs
  let imageValue = $("project-image").value.trim();
  let videoUrl = $("project-video-url").value.trim();

  // If admin selected an image file, convert to base64 and use it
  const imgFileInput = $("project-image-file");
  if (imgFileInput && imgFileInput.files && imgFileInput.files[0]) {
    const dataUrl = await fileToDataUrl(imgFileInput.files[0]);
    if (isProbablyTooBigForLocalStorage(dataUrl)) {
      return showMsg("Image too large. Use a smaller image or a URL/path.");
    }
    imageValue = dataUrl; // store base64 image
  }

  // If admin selected a video file, try convert to base64 (small only)
  const vidFileInput = $("project-video-file");
  if (vidFileInput && vidFileInput.files && vidFileInput.files[0]) {
    const dataUrl = await fileToDataUrl(vidFileInput.files[0]);
    if (isProbablyTooBigForLocalStorage(dataUrl)) {
      return showMsg("Video too large for browser storage. Use a video URL instead.");
    }
    videoUrl = dataUrl; // store base64 video (only for small videos)
  }

  const data = {
    id,
    title: $("project-title").value.trim(),
    category: $("project-category").value,
    desc: $("project-desc").value.trim(),
    price: $("project-price").value === "" ? "" : Number($("project-price").value),
    image: imageValue,
    videoUrl: videoUrl
  };

  const idx = projects.findIndex(x => x.id === id);
  if(idx >= 0) projects[idx] = data;
  else projects.unshift(data);

  setProjects(projects);
  renderProjects();
  $("project-id").value = id;
  $("delete-project-btn").disabled = false;
  showMsg("Project saved.");
}

    function deleteProject(){
      const id = $("project-id").value;
      if(!id) return;

      const ok = confirm("Delete this project?");
      if(!ok) return;

      let projects = getProjects();
      projects = projects.filter(x => x.id !== id);
      setProjects(projects);
      renderProjects();
      resetForm();
      showMsg("Project deleted.");
    }

    // ====== Render Clients ======
    function renderClients(){
      const clients = getClients();
      const empty = $("clients-empty");
      const table = $("clients-table");
      const body = $("clients-body");

      body.innerHTML = "";

      if(clients.length === 0){
        empty.classList.remove("hidden");
        table.style.display = "none";
        return;
      }

      empty.classList.add("hidden");
      table.style.display = "table";

      clients.slice().reverse().forEach(c => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td><strong>${escapeHtml(c.name || "—")}</strong></td>
          <td class="muted">${escapeHtml(c.email || "—")}</td>
          <td>${escapeHtml(c.projectTitle || "—")}</td>
          <td>$${Number(c.amount || 0).toFixed(2)}</td>
          <td class="muted">${escapeHtml(c.date || "—")}</td>
        `;
        body.appendChild(tr);
      });
    }

    // ====== Export / Clear ======
    function downloadJson(filename, obj){
      const blob = new Blob([JSON.stringify(obj, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    function seedDemo(){
      const demoProjects = [
        { id: newId(), title:"iOS UI Kit", category:"uiux", desc:"Complete mobile wireframe kit.", price:29, image:"images/uiux.png" },
        { id: newId(), title:"Moodboard Pack", category:"interior", desc:"Textures, palettes, and style references.", price:19, image:"images/interior.png" },
        { id: newId(), title:"Modern Facade Concept", category:"exterior", desc:"Exterior elevation with materials.", price:39, image:"images/exterior.png" }
      ];
      const demoClients = [
        { name:"Client One", email:"client1@example.com", projectTitle:"iOS UI Kit", amount:29, date:new Date().toISOString().slice(0,10) },
        { name:"Client Two", email:"client2@example.com", projectTitle:"Modern Facade Concept", amount:39, date:new Date().toISOString().slice(0,10) }
      ];
      setProjects(demoProjects);
      setClients(demoClients);
      renderProjects();
      renderClients();
      showMsg("Demo data added.");
    }

    // ====== Basic XSS protection for table rendering ======
    function escapeHtml(str){
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    // ====== Events ======
    ensurePassword();

    $("login-btn").addEventListener("click", () => {
      const input = $("admin-password").value;
      const real = localStorage.getItem(KEY_ADMIN_PASS) || DEFAULT_PASS;

      if(input === real){
        setAuthed(true);
        showDashboard();
      } else {
        alert("Wrong password.");
      }
    });

    $("change-pass-btn").addEventListener("click", () => {
      const current = prompt("Enter current password:");
      if(current === null) return;

      const real = localStorage.getItem(KEY_ADMIN_PASS) || DEFAULT_PASS;
      if(current !== real) return alert("Current password is wrong.");

      const newPass = prompt("Enter new password (min 4 chars):");
      if(!newPass || newPass.length < 4) return alert("Password too short.");

      localStorage.setItem(KEY_ADMIN_PASS, newPass);
      alert("Password changed.");
    });

    $("logout-btn").addEventListener("click", () => {
      setAuthed(false);
      showLogin();
    });

    $("save-project-btn").addEventListener("click", saveProject);
    $("reset-form-btn").addEventListener("click", resetForm);
    $("delete-project-btn").addEventListener("click", deleteProject);

    $("export-projects-btn").addEventListener("click", () => downloadJson("gs-projects.json", getProjects()));
    $("export-clients-btn").addEventListener("click", () => downloadJson("gs-clients.json", getClients()));

    $("clear-projects-btn").addEventListener("click", () => {
      if(confirm("Clear ALL projects?")) {
        setProjects([]);
        renderProjects();
        resetForm();
      }
    });

    $("clear-clients-btn").addEventListener("click", () => {
      if(confirm("Clear ALL clients/purchases?")) {
        setClients([]);
        renderClients();
      }
    });

    $("seed-demo-btn").addEventListener("click", seedDemo);

    // ====== Auto-open correct view ======
    if(isAuthed()) showDashboard();
    else showLogin();
  </script>
</body>
</html>




